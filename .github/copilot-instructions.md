# Copilot Instructions for Artsdata Nebula

## Project Overview
- **Artsdata Nebula** is a Rails 7 web app for managing and viewing Artsdata datafeeds and minted entities, built on top of the Artsdata API Platform.
- The app is "low code": business logic and data validation are managed via SPARQL and SHACL files (see `app/services/sparqls/`, `app/services/shacls/`).
- Supports generic RDF viewing and dereferencing of linked data URIs, not just Artsdata-specific content.
- User authentication is via GitHub OAuth; integration with the Artsdata Nebula GitHub App enables remote workflow execution in other repos.

## Key Architecture & Patterns
- **Controllers**: RESTful Rails controllers in `app/controllers/` handle entity, artifact, reconciliation, minting, validation, and more. Each controller is focused on a specific domain (e.g., `entity_controller.rb`, `mint_controller.rb`).
- **Services**: Business logic and data access are in `app/services/`, especially:
  - `databus_service.rb`, `recon_service.rb`, `sparql_loader.rb`, and subfolders for graph and SHACL logic.
- **Views**: Rails views in `app/views/` and assets in `app/assets/`.
- **Feature Flags**: Toggle features in `config/initializers/feature_flags.rb` (e.g., maintenance mode, minting).
- **External Data**: All tabular and graph views are generated by SPARQL queries; validation is SHACL-driven.
- **Content Negotiation**: Follows linked data principles for dereferencing URIs.

## Developer Workflows
- **Setup**: `bundle install`, copy `config/master.key`, then `rails server` to run locally.
- **Testing**: Run `rails test` for the test suite.
- **Credentials**: Edit with `EDITOR="code --wait" rails credentials:edit`.
- **Feature Flags**: Edit `config/initializers/feature_flags.rb` to enable/disable features.
- **GitHub App**: Ensure the Artsdata Nebula GitHub App is installed and has access to required repos for workflow integration.

## Conventions & Integration
- **SPARQL/SHACL**: All business rules and validation are externalized; avoid hardcoding logic in Ruby.
- **I18n**: Translations in `config/locales/`.
- **Docs**: User-facing docs in `doc/`, including localized home pages.
- **UI**: Uses Bootstrap via Importmap (see setup in README).
- **Batch Reconciliation UI**: Separate frontend in `artsdata-batch-reconciliation-ui/` (Vite/JS, see its own README for details).

## Examples
- To add a new validation rule: add a SHACL file in `app/services/shacls/`.
- To add a new SPARQL-driven view: add a query in `app/services/sparqls/` and reference it from the relevant controller.
- To enable maintenance mode: set the flag in `config/initializers/feature_flags.rb`.

## Key Files & Directories
- `app/controllers/`, `app/services/`, `app/models/`, `app/views/`
- `config/initializers/feature_flags.rb`, `config/locales/`, `doc/`
- `artsdata-batch-reconciliation-ui/` (standalone frontend)

---
For more, see the main [README.md](../README.md) and [doc/](../doc/).
